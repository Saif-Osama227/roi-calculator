<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finance Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 20px auto; padding: 20px; border: 1px solid #ddd; border-radius: 10px; background: #f9f9f9; }
    label { font-weight: bold; display: block; margin-top: 15px; }
    input, select { padding: 5px; width: 100%; margin-top: 5px; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
  </style>
</head>
<body>
  <h2>Finance Calculator</h2>

  <label for="price">Total Price (AED):</label>
  <input type="number" id="price" value="122500" />

  <label for="dpPercent">Down Payment %:</label>
  <input type="number" id="dpPercent" value="55" />

  <label for="dpAmount">OR Down Payment Amount (AED):</label>
  <input type="number" id="dpAmount" value="67375" />

  <label for="salary">Monthly Salary (AED):</label>
  <input type="number" id="salary" value="15000" />

  <label for="nationality">Nationality:</label>
  <select id="nationality">
    <option value="local">UAE National</option>
    <option value="expat" selected>Expat</option>
  </select>

  <label for="bank">Select Bank:</label>
  <select id="bank">
    <option value="ENBD">Emirates NBD</option>
    <!-- More banks to be added later -->
  </select>

  <div id="result"></div>

  <script>
    const tenureMonths = [12, 24, 36, 48, 60];

    function getENBDRate(salary, nationality) {
      if (nationality === 'local') return 2.89;
      if (salary >= 50000) return 3.09;
      if (salary >= 30000) return 3.39;
      if (salary >= 15000) return 3.59;
      if (salary >= 10000) return 3.89;
      if (salary >= 6000) return 4.09;
      return 5.0; // fallback rate
    }

    function calculate() {
      const price = parseFloat(document.getElementById('price').value);
      const dpPercentField = document.getElementById('dpPercent');
      const dpAmountField = document.getElementById('dpAmount');
      const salary = parseFloat(document.getElementById('salary').value);
      const bank = document.getElementById('bank').value;
      const nationality = document.getElementById('nationality').value;

      let dpAmount = parseFloat(dpAmountField.value);
      let dpPercent = parseFloat(dpPercentField.value);

      // Sync percentage to amount and vice versa
      const source = event.target.id;
      if (source === 'dpPercent' || source === 'price') {
        dpAmount = (dpPercent / 100) * price;
        dpAmountField.value = dpAmount.toFixed(2);
      } else if (source === 'dpAmount') {
        dpPercent = (dpAmount / price) * 100;
        dpPercentField.value = dpPercent.toFixed(2);
      }

      const financeAmount = price - dpAmount;
      let roi = 5.0;

      if (bank === 'ENBD') {
        roi = getENBDRate(salary, nationality);
      }

      const monthlyROI = roi / 100 / 12;

      let table = `<p>ROI: <strong>${roi.toFixed(2)}%</strong></p>`;
      table += `<table><tr><th>Tenure (Months)</th><th>Total Interest</th><th>EMI (Monthly)</th></tr>`;

      tenureMonths.forEach(months => {
        const emi = (financeAmount * monthlyROI) / (1 - Math.pow(1 + monthlyROI, -months));
        const totalInterest = emi * months - financeAmount;
        table += `<tr><td>${months}</td><td>AED ${totalInterest.toFixed(2)}</td><td>AED ${emi.toFixed(2)}</td></tr>`;
      });

      table += '</table>';
      document.getElementById('result').innerHTML = table;
    }

    document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', calculate));
    window.onload = calculate;
  </script>
</body>
</html>
