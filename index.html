<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Finance Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 20px auto; padding: 20px; border: 1px solid #ddd; border-radius: 10px; background: #f9f9f9; }
    label { font-weight: bold; display: block; margin-top: 15px; }
    input, select { padding: 5px; width: 100%; margin-top: 5px; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #eee; }
    .conditional { display: none; }
  </style>
</head>
<body>
  <h2>Finance Calculator (Flat Interest)</h2>

  <label for="price">Total Price (AED):</label>
  <input type="number" id="price" value="122500" />

  <label for="dpPercent">Down Payment %:</label>
  <input type="number" id="dpPercent" value="55" />

  <label for="dpAmount">OR Down Payment Amount (AED):</label>
  <input type="number" id="dpAmount" value="67375" />

  <label for="salary">Monthly Salary (AED):</label>
  <input type="number" id="salary" value="15000" />

  <label for="ownership">Car Ownership:</label>
  <select id="ownership">
    <option value="retail" selected>Retail</option>
    <option value="managed">Managed</option>
  </select>

  <label for="nationality">Nationality:</label>
  <select id="nationality">
    <option value="local">UAE National</option>
    <option value="expat" selected>Expat</option>
  </select>

  <label for="bank">Select Bank:</label>
  <select id="bank">
    <option value="ENBD">Emirates NBD</option>
    <option value="DIB">Dubai Islamic Bank</option>
  </select>

  <div id="dibOptions" class="conditional">
    <label for="gv">Are you a Golden Visa holder?</label>
    <select id="gv">
      <option value="no" selected>No</option>
      <option value="yes">Yes</option>
    </select>

    <label for="bankingCustomer">Are you a DIB Banking Customer?</label>
    <select id="bankingCustomer">
      <option value="no" selected>No</option>
      <option value="yes">Yes</option>
    </select>
  </div>

  <div id="result"></div>

  <script>
    const tenureMonths = [12, 24, 36, 48, 60];

    function getENBDRate(salary, nationality) {
      if (nationality === 'local') return 2.89;
      if (salary >= 50000) return 3.09;
      if (salary >= 30000) return 3.39;
      if (salary >= 15000) return 3.59;
      if (salary >= 10000) return 3.89;
      if (salary >= 6000) return 4.09;
      return 5.0;
    }

    function getDIBRate(salary, nationality, ownership, goldenVisa, banking) {
      let slabs;
      const s = salary;
      const gv = goldenVisa === 'yes';
      const bank = banking === 'yes';

      if ((nationality === 'local' || gv) && ownership === 'retail') {
        slabs = [[4999, 5.25], [9999, 3.50], [14999, 3.25], [24999, 2.60], [34999, 2.50], [Infinity, 2.35]];
      } else if (nationality === 'expat' && ownership === 'retail') {
        slabs = bank
          ? [[4999, 6.00], [9999, 5.00], [14999, 4.50], [24999, 4.00], [34999, 3.25], [Infinity, 3.25]]
          : [[4999, 6.00], [9999, 5.00], [14999, 4.50], [24999, 4.15], [34999, 3.50], [Infinity, 3.25]];
      } else if ((nationality === 'local' || gv) && ownership === 'managed') {
        slabs = [[4999, 5.40], [9999, 3.65], [14999, 3.40], [24999, 2.75], [34999, 2.65], [Infinity, 2.50]];
      } else {
        slabs = bank
          ? [[4999, 6.15], [9999, 5.15], [14999, 4.65], [24999, 4.15], [34999, 3.40], [Infinity, 3.40]]
          : [[4999, 6.15], [9999, 5.15], [14999, 4.65], [24999, 4.30], [34999, 3.65], [Infinity, 3.40]];
      }

      for (const [limit, rate] of slabs) {
        if (s <= limit) return rate;
      }
      return 5.0;
    }

    function calculate(event) {
      const price = parseFloat(document.getElementById('price').value);
      const dpPercentField = document.getElementById('dpPercent');
      const dpAmountField = document.getElementById('dpAmount');
      const salary = parseFloat(document.getElementById('salary').value);
      const bank = document.getElementById('bank').value;
      const nationality = document.getElementById('nationality').value;
      const ownership = document.getElementById('ownership').value;
      const goldenVisa = document.getElementById('gv')?.value || 'no';
      const banking = document.getElementById('bankingCustomer')?.value || 'no';

      let dpAmount = parseFloat(dpAmountField.value);
      let dpPercent = parseFloat(dpPercentField.value);

      const source = event?.target?.id;
      if (source === 'dpPercent' || source === 'price') {
        dpAmount = (dpPercent / 100) * price;
        dpAmountField.value = dpAmount.toFixed(2);
      } else if (source === 'dpAmount') {
        dpPercent = (dpAmount / price) * 100;
        dpPercentField.value = dpPercent.toFixed(2);
      }

      const financeAmount = price - dpAmount;
      let roi = 5.0;

      if (bank === 'ENBD') {
        roi = getENBDRate(salary, nationality);
      } else if (bank === 'DIB') {
        roi = getDIBRate(salary, nationality, ownership, goldenVisa, banking);
      }

      let table = `<p>ROI (Flat): <strong>${roi.toFixed(2)}%</strong></p>`;
      table += `<table><tr><th>Tenure (Months)</th><th>Total Interest</th><th>Total Payable</th><th>EMI (Monthly)</th></tr>`;

      tenureMonths.forEach(months => {
        const years = months / 12;
        const totalInterest = financeAmount * (roi / 100) * years;
        const totalPayable = financeAmount + totalInterest;
        const emi = totalPayable / months;

        table += `<tr><td>${months}</td><td>AED ${totalInterest.toFixed(2)}</td><td>AED ${totalPayable.toFixed(2)}</td><td>AED ${emi.toFixed(2)}</td></tr>`;
      });

      table += '</table>';
      document.getElementById('result').innerHTML = table;
    }

    function toggleConditionalFields() {
      const isDIB = document.getElementById('bank').value === 'DIB';
      document.getElementById('dibOptions').style.display = isDIB ? 'block' : 'none';
    }

    document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', calculate));
    document.getElementById('bank').addEventListener('change', () => {
      toggleConditionalFields();
      calculate();
    });
    document.getElementById('ownership').addEventListener('change', calculate);
    window.onload = () => {
      toggleConditionalFields();
      calculate();
    };
  </script>
</body>
</html>
